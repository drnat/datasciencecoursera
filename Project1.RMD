Statistical Inference (Project 1) 
==================================================

Overview
---------------------------
This report will demonstrate the central limit theorem using a simulation exercise with an exponential distribution. Specifically, it will show that the distribution of the population estimates (in this case, the mean and variance) follow an approximately normal distribution if a large number of sample estimates are made - even when the distribution from which each sample estimate is drawn is not normally distributed.  

The Exponential Function
---------------------------
First, let's describe an exponential distribution:
$$
        \begin{aligned}
        \ 1-e^{(-x/b)}
        \ or 
        \ 1-e^{(-\lambda x)}
        \end{aligned}
$$

-  It is a function that describes a continuous random variable.
-  It has a single parameter, the mean (b), that describes the 'scale' of the observations with variance, $var=b^2$ , and standard deviation, $s=\sqrt{var}=b$. 
-  It can also be described by a hazard or rate parameter, lambda (&lambda;), which is related to the mean by $b=1/\lambda;$.


Second, let's examine the exponential distribution generated for 40 and 1000 random observations drawn from an exponential with a rate (&lambda;) equal to 0.2:


```{r Example exponential, fig.width=10, fig.height=4, message=FALSE, echo=FALSE}
library (ggplot2)
require(gridExtra)

lambda <- 0.2
expeg <- data.frame(matrix(rexp(1040, rate=lambda), 1040, 1),c(rep("40 Observations",40),rep("1,000 Observations",1000)))
colnames(expeg) <- c("Observations", "Dataset")

x1 <- expeg[which(expeg$Dataset=='40 Observations'),]
x2 <- expeg[which(expeg$Dataset=='1,000 Observations'),]

p1 <- qplot( x=x1$Observations, data=x1)+
        geom_histogram(colour="black",  aes(fill =..density..))+
        scale_fill_gradient("Count", low = "lightblue", high = "darkblue",guide = guide_legend(title = "Density"))+
        labs(title="Exp Distribution \n 40 Observations", x="Observations", y="Count")+
        geom_vline(xintercept=mean(expeg$Observations), colour="red")+
        theme_bw()
p2 <- qplot( x=x2$Observations, data=x2)+
        geom_histogram(colour="black",  aes(fill =..density..))+
        scale_fill_gradient("Count", low = "lightgreen", high = "darkgreen",guide = guide_legend(title = "Density"))+
        labs(title="Exp Distribution \n 1,000 Observations", x="Observations", y="Count")+
        geom_vline(xintercept=mean(expeg$Observations), colour="red")+
        theme_bw()

grid.arrange(p1, p2, ncol=2)

```
```{r plyr means, message=FALSE, echo=FALSE}
library (plyr)
means<- ddply(expeg, "Dataset", function(x) mean(x$Observations))

```

#### Figure 1: Comparison of 40 and 1000 random observations drawn from an exponential distribution

Regardless of sample size, we can see that with an exponential distribution observations with low values occur more frequently (darker/taller bars) than observations with higher values (lighter/shorter bars). This relationship is more 'well behaved' when the sample size is larger. The red lines on each graph indicate the respective mean values: b<sub>40</sub> = `r round(means$V1[2], digits=3)` and b<sub>1000</sub> = `r round(means$V1[1], digits=3)`. The corresponding variance of each distribution are var<sub>40</sub> = `r round((means$V1[2])^2, digits=3)` and var<sub>1000</sub> = `r round((means$V1[1])^2, digits=3)`.


Simulations
---------------------------
The purpose of the simulation is to repeat 1,000 times the random generation of 40 observations from an exponential distribution with &lambda;=0.2. Rather than plot the distribution for each repeat, instead we will plot the mean and the variance generated by each repeat and go on to examine the distribution of the means and of the variances. 

```{r Means of 40 exp}
# Generate a vector of 1,000 means of each random generation of 40 observations for the exponential distribution
mns = NULL
for (i in 1 : 1000) mns = c(mns, mean(rexp(40, rate=lambda)))

# Generate a vector of 1,000 variances of each random generation of 40 observations for the exponential distribution
vars = mns^2

data<-as.data.frame(cbind(mns, vars))
colnames(data) <- c("Means", "Variances")


```
Sample Mean versus Theoretical Mean 
---------------------------
The expected value of an exponential random variable is:
$$
        \begin{aligned}
        \ E[X] = 1/\lambda = b
        \end{aligned}
$$


Here is the R code and figure illustrating the distribution of the mean from each of the 1,000 repeats:
 
```{r Distribution of Means 40exp, message=FALSE}
pmean <- ggplot(data=data, aes(x=Means))
pmean   +
        geom_histogram(colour="black",  aes(fill =..density..))+
        scale_fill_gradient("Count", low = "lightblue", high = "darkblue",guide = guide_legend(title = "Density"))+
        labs(title="Distribution of Means from 1,000 repeats \n 40 Observations", x="Observations", y="Count")+
        geom_vline(xintercept=mean(data$Means), colour="red", lty=1, lwd=1)+
        geom_vline(xintercept=5, colour="green", lty=2, lwd=1)+
        theme_bw()


```

#### Figure 2: Distribution of the means of 1000 sets of 40 random observations drawn from an exponential distribution

The distribution of means from each repeat shown in the figure above is approximately symmetrical about the mean of the means (`r round(mean(data$Means), digits=3)`; red line). Since &lambda;=0.2, the expected value corresponds very closely to the mean of the means ($b=5$; dotted green line). 


Sample Variance versus Theoretical Variance 
---------------------------
The theoretical value of the variance is $b^2$. Here is the R code and figure illustrating the distribution of the variance from each of the 1,000 repeats of 40 random exponential observations. 

```{r Distribution of Variances 40exp, message=FALSE}
pmean <- ggplot(data=data, aes(x=Variances))
pmean   +
        geom_histogram(colour="black",  aes(fill =..density..))+
        scale_fill_gradient("Count", low = "lightgreen", high = "darkgreen",guide = guide_legend(title = "Density"))+
        labs(title="Distribution of Variances from 1,000 repeats \n 40 Observations", x="Observations", y="Count")+
        geom_vline(xintercept=mean(data$Variances), colour="red", lty=1, lwd=1)+
        geom_vline(xintercept=25, colour="green", lty=2, lwd=1)+
        theme_bw()


```

#### Figure 3: Distribution of the variances of 1000 sets of 40 random observations drawn from an exponential distribution

The distribution of variances from each repeat shown in the figure above is also approximately symmetrical about the middle of the variances (`r round(mean(data$Variances), digits=3)`; red line) - at least, more symmetrical than the exponential distribution itself. Since the theoretical variance is $b^2$ and the expected value of $b$ is 5, the theoretical variance corresponds very closely to the middle of the distribution of the variances (dotted green line). 

Distribution 
---------------------------
The variance of the population means, $\sigma^2/n$, is estimated by the sample variance, $s^2/n$ and the sample standard deviation is $s=\sqrt{s^2}$.  

```{r Generate Data for Density Plots}
# Generate Z scores for means
n <- length(data$Means)
mean <- mean (data$Means)
sdmean <- sd (data$Means)

data$meansZ<-((data$Means - mean)/sdmean)

# Generate Z scores for variances
n <- length(data$Variances)
meanV <- mean (data$Variances)
sdV <- sd (data$Variances)

data$variancesZ<-(data$Variances - meanV)/sdV

```

```{r Normalised Distributions, message=FALSE}
pmeanN <- ggplot(data=data, aes(x=meansZ))
p3 <- pmeanN   +
        geom_histogram(aes(y =..density..), colour="black", fill="dodgerblue3")+
        labs(title="Normalised Dist. of Means \n from 1,000 repeats 40 Obs.", x="Observations of Mean as Z Score", y="Density")+
        stat_function(fun = dnorm, colour="red", lwd=1.5)+
        theme_bw()

pvarN <- ggplot(data=data, aes(x=variancesZ))
p4 <- pvarN   +
        geom_histogram(aes(y =..density..), colour="black", fill="springgreen3")+
        labs(title="Normalised Dist. of Variances \n from 1,000 repeats 40 Obs.", 
             x="Observations of Variance as Z Score", y="Density")+
        stat_function(fun = dnorm, colour="red", lwd=1.5)+
        theme_bw()

grid.arrange(p3, p4, ncol=2)
```

#### Figure 4: Normalised distribution of the means (left) and variances (right) of 1000 sets of 40 random observations drawn from an exponential distribution. A normal distribution density function is overlayed on each (red line).

The distributions of the means and variances, which are sample estimates from each sample drawn, can be described as approximately normal because they match, relatively closely, the normal distribution density function. This is not the case if we compare 1,000 observations from an exponential function with the normal distribution density function (Figure 5).

```{r Sample estimates vs sample, message=FALSE, echo=FALSE}
# Generate Z scores for 1,000 observations
nobs <- length(x2$Observations)
meanobs <- mean (x2$Observations)
sdmeanobs <- sd (x2$Observations)

x2$ObservationsZ<-((x2$Observations - meanobs)/sdmeanobs)

#1,000 observations from exponential distribution
p1000 <- ggplot(data=x2, aes(x=x2$ObservationsZ))

p5 <- p1000 +
        geom_histogram(aes(y =..density..), colour="black", fill="lightblue2")+
        labs(title="Exp Distribution \n 1,000 Observations", x="Observations", y="Denisty")+
        stat_function(fun = dnorm, colour="red", lwd=1.5)+
        theme_bw()

p3 <- pmeanN   +
        geom_histogram(aes(y =..density..), colour="black", fill="dodgerblue3")+
        labs(title="Normalised Dist. of Means \n from 1,000 repeats 40 Obs.", x="Observations of Mean as Z Score", y="Density")+
        stat_function(fun = dnorm, colour="red", lwd=1.5)+
        theme_bw()

grid.arrange(p5, p3, ncol=2)
```

#### Figure 5: Normalised distribution of the means (left) and variances (right) of 1000 sets of 40 random observations drawn from an exponential distribution. A normal distribution density function is overlayed on each (red line).
